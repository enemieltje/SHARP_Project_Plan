\DTLnewdb{workpackages}
\DTLnewdb{activities}

\newcommand{\WPadd}[9]{
    \DTLnewrow{workpackages}
    \DTLnewdbentry{workpackages}{id}{WP-#1}
    \DTLnewdbentry{workpackages}{label}{#2}
    \DTLnewdbentry{workpackages}{long}{#3}
    \DTLnewdbentry{workpackages}{input}{#4}
    \DTLnewdbentry{workpackages}{activities}{#5}
    \DTLnewdbentry{workpackages}{deliverables}{#6}
    \DTLnewdbentry{workpackages}{start}{#7}
    \DTLnewdbentry{workpackages}{end}{#8}
    \DTLnewdbentry{workpackages}{hours}{#9}
}

\newcommand{\ACTadd}[4]{
    \DTLnewrow{activities}
    \DTLnewdbentry{activities}{wpid}{#1}
    \DTLnewdbentry{activities}{id}{#2}
    \DTLnewdbentry{activities}{activity}{#3}
    \DTLnewdbentry{activities}{hours}{#4}
}

\newcommand{\ACT}[2]{%
    \DTLfetch{activities}{id}{#1}{#2}%
}

\newcommand{\WP}[2]{%
    \DTLfetch{workpackages}{id}{#1}{#2}%
}

\newcommand{\ACTitems}[1]{
\DTLforeach[\DTLiseq{\wpid}{#1}]{activities}
{\wpid=wpid, \act=activity, \hrs=hours}
{
\item \act\ [\hrs]
}
}

\newcommand{\WPtable}[1]{

    \begin{tabular}{|l|p{9.7cm}|l|l|}
        \hline
        \textbf{WP\#}         & {#1}                                        & \textbf{Start:} & \WP{#1}{start} \\
        \hline
        \textbf{Title}        & \WP{#1}{label}                              & \textbf{End:}   & \WP{#1}{end}   \\
        \hline
        \textbf{Objectives}   & \multicolumn{3}{p{11.6cm}|}{\WP{#1}{long}}                                     \\
        \hline
        \textbf{Inputs}       & \multicolumn{3}{p{11.6cm}|}{\WP{#1}{input}}                                    \\
        \hline
        \textbf{Activities}   & \multicolumn{3}{p{11.6cm}|}{
            \begin{enumerate}
                % \WP{#1}{activities}
                \ACTitems{#1}
            \end{enumerate}
        }                                                                                                      \\
        \hline
        \textbf{Deliverables} & \multicolumn{3}{p{11.6cm}|}{
            \begin{enumerate}
                \WP{#1}{deliverables}
            \end{enumerate}
        }                                                                                                      \\
        \hline
        \textbf{Hours}        & \multicolumn{3}{p{11.6cm}|}{\WP{#1}{hours}}                                    \\
        \hline
    \end{tabular}
}

\newcommand{\Workpackages}{
    \DTLforeach{workpackages}{
        \id=id%
    }{
        \WPtable{\id}
        \vspace{0.5cm}
    }
}

\newcommand{\WPlist}[1]{
    \begin{enumerate}
        \DTLforeach{workpackages}{
        \id=id%
        }{
        \renewcommand{\labelenumi}{\id}
        \item \WP{\id}{label}
              \begin{enumerate}
                  \WP{\id}{#1}
              \end{enumerate}
              }
    \end{enumerate}
}

\newcommand{\WPactivities}{
    \begin{enumerate}
        \DTLforeach{workpackages}{
        \id=id%
        }{
        \renewcommand{\labelenumi}{\id}
        \item \WP{\id}{label}
              \begin{enumerate}
                  \ACTitems{\id}
              \end{enumerate}
              }
    \end{enumerate}
}

\newcommand{\mytabcontent}{}

\newcommand{\ACTtable}{

    \DTLforeach*{workpackages}{\wp=id,\label=label,\hrs=hours}{
        \renewcommand{\mytabcontent}{
            \begin{tabularx}{\textwidth}{|l|X|r|}%
                \hline%
                \wp\        & \label\  & \hrs\   \\
                \hline%
                }

                \DTLforeach[\DTLiseq{\wpid}{\wp}]{activities}
                {\wpid=wpid,\id=id,\act=activity,\hours=hours}
                {
                    \eappto{\mytabcontent}{
                \wpid.\id\  & \act\    & \hours\ \\
                    }
                }

                \appto{\mytabcontent}{
                \hline
            \end{tabularx}
        }
        \mytabcontent%
    }
}

% \DTLnewdbentry{workpackages}{id}{WP-#1}
% \DTLnewdbentry{workpackages}{label}{#2}
% \DTLnewdbentry{workpackages}{long}{#3}
% \DTLnewdbentry{workpackages}{input}{#4}
% \DTLnewdbentry{workpackages}{activities}{#5} deprecated
% \DTLnewdbentry{workpackages}{deliverables}{#6}
% \DTLnewdbentry{workpackages}{start}{#7}
% \DTLnewdbentry{workpackages}{end}{#8}
% \DTLnewdbentry{workpackages}{hours}{#9}

\WPadd{1}{Planning}
{Define the project scope, requirements, and test strategy for the hydrogen-based power system test bench.}
{Project assignment, background literature, mission scenario description}
{
    \item old
    % \item Literature study on hydrogen storage, fuel cells, and UAV power systems
    % \item Analysis of mission scenario and system constraints
    % \item Definition of functional, performance, and safety requirements
    % \item Definition of test objectives, success criteria, and test strategy
    % \item Writing and finalising the project plan
}
{
    \item Literature review summary
    \item System requirements specification
    \item Test strategy and safety considerations
    \item Approved project plan
}
{\formatdate{2}{2}{2026}}{\formatdate{22}{2}{2026}}
{120}

\ACTadd{WP-1}{1}{Literature study on hydrogen storage and fuel cells}{20}
\ACTadd{WP-1}{2}{Analysis of mission scenario and constraints}{10}
\ACTadd{WP-1}{3}{Definition of functional and safety requirements}{20}
\ACTadd{WP-1}{4}{Definition of test strategy and success criteria}{10}
\ACTadd{WP-1}{5}{Writing and finalising the project plan}{60}


\WPadd{2}{Design}
{Develop a detailed and buildable design for the hydrogen-based power system test bench.}
{System requirements specification, project plan}
{
    \item old
    % \item Development of multiple conceptual test bench architectures
    % \item Definition of system boundaries and interfaces
    % \item Trade-off analysis and concept selection
    % \item Detailed mechanical and electrical design
    % \item Component selection and verification against requirements
}
{
    \item Selected test bench concept
    \item CAD models and mechanical drawings
    \item Electrical schematics
    \item Bill of materials (BOM)
}
{\formatdate{23}{2}{2026}}{\formatdate{29}{3}{2026}}
{200}

\ACTadd{WP-2}{1}{Conceptual design of UAV architecture}{40}
\ACTadd{WP-2}{2}{Development of multiple conceptual test bench architectures}{40}
\ACTadd{WP-2}{3}{Definition of system boundaries and interfaces}{20}
\ACTadd{WP-2}{4}{Trade-off analysis and concept selection}{10}
\ACTadd{WP-2}{5}{Detailed mechanical and electrical design}{80}
\ACTadd{WP-2}{6}{Component selection and verification against requirements}{10}

\WPadd{3}{Build}
{Procure, assemble, and integrate the hydrogen-based power system test bench.}
{Detailed design documentation, bill of materials}
{
    \item old
    % \item Supplier selection and procurement of components
    % \item Incoming inspection and preparation of parts
    % \item Manufacturing of mechanical parts where required
    % \item Assembly of mechanical, electrical, and fluidic subsystems
    % \item Integration of fuel cell, storage, and power electronics
}
{
    \item Fully assembled and integrated test bench
    \item Updated BOM and cost overview
    \item Assembly and integration documentation
}
{\formatdate{30}{3}{2026}}{\formatdate{3}{5}{2026}}
{200}

\ACTadd{WP-3}{1}{Supplier selection and procurement of components}{??}
% \ACTadd{WP-3}{2}{Incoming inspection and preparation of parts}{1}
\ACTadd{WP-3}{2}{Manufacturing of mechanical parts where required}{40}
\ACTadd{WP-3}{3}{Assembly of mechanical, electrical, and fluidic subsystems}{80}
\ACTadd{WP-3}{4}{Integration of fuel cell, storage, and power electronics}{80}

\WPadd{4}{Test}
{Verify the performance and feasibility of the hydrogen-based power system through experimental testing.}
{Integrated test bench, test plan}
{
    \item old
    % \item Finalisation of test procedures and safety measures
    % \item Execution of ground tests under controlled conditions
    % \item Measurement of power output, efficiency, and system stability
    % \item Data logging and documentation of test results
    % \item Analysis of measured data and comparison with requirements
}
{
    \item Test logs and raw measurement data
    \item Performance analysis results
    \item Technical feasibility assessment
}
{\formatdate{4}{5}{2026}}{\formatdate{24}{5}{2026}}
{120}

\ACTadd{WP-4}{1}{Finalisation of test procedures and safety measures}{20}
\ACTadd{WP-4}{2}{Execution of ground tests under controlled conditions}{60}
% \ACTadd{WP-4}{3}{Measurement of power output, efficiency, and system stability}{30}
\ACTadd{WP-4}{3}{Data logging and documentation of test results}{20}
\ACTadd{WP-4}{4}{Analysis of measured data and comparison with requirements}{20}

\WPadd{5}{Report}
{Document the project work, results, and conclusions in a clear and professional manner.}
{Project documentation, test results, analysis outputs}
{
    \item old
    % \item Writing of the final internship and research report
    % \item Documentation of design, build, and test phases
    % \item Preparation of figures, tables, and appendices
    % \item Final review, revision, and submission
}
{
    \item Final project report
    \item Reflection report
    \item Company presentation assessment by Company Supervisor
    \item Poster presentation preparations
}
{\formatdate{25}{5}{2026}}{\formatdate{14}{6}{2026}}
{120}

\ACTadd{WP-5}{1}{Writing progress report}{10}
\ACTadd{WP-5}{2}{Finalising documentation of design, build, and test phases}{10}
\ACTadd{WP-5}{3}{Submitting draft graduation report}{40}
\ACTadd{WP-5}{4}{Incorporating feedback into final graduation report}{20}
\ACTadd{WP-5}{5}{Writing reflection report}{20}
\ACTadd{WP-5}{6}{Preparing company presentation}{10}
\ACTadd{WP-5}{7}{Preparing poster presentation}{10}


% \WPadd{1}{Project Definition and Requirements}
% {Define the problem, scope, and requirements for the hydrogen-based power system test bench.}
% {input}
% {
%     \item Literature study on hydrogen storage, fuel cells, and UAV power systems
%     \item Analysis of mission scenario and system constraints
%     \item Definition of functional, performance, and safety requirements
%     \item Writing and finalising the project plan
% }
% {
%     \item Literature review summary
%     \item System requirements specification
%     \item Approved project plan
% }
% {\formatdate{2}{2}{2026}}{\formatdate{13}{2}{2026}}
% {100}

% \WPadd{2}{Conceptual Design of Test Bench}
% {Develop and select a suitable concept for the hydrogen-based power system test bench.}
% {input}
% {
%     \item Development of multiple conceptual test bench architectures
%     \item Definition of system boundaries and interfaces
%     \item Trade-off analysis of concepts based on requirements
%     \item Selection of the preferred test bench concept
% }
% {
%     \item Overview of conceptual design alternatives
%     \item Trade-off analysis and decision matrix
%     \item Selected test bench concept
% }
% {\formatdate{2}{2}{2026}}{\formatdate{13}{2}{2026}}
% {100}

% \WPadd{3}{Detailed Design of Test Bench}
% {Translate the selected test bench concept into a detailed and buildable design.}
% {input}
% {
%     \item Detailed mechanical design of the test bench
%     \item Electrical system design and schematic development
%     \item Component selection for fuel cell, storage, and power electronics
%     \item Verification of the design against system requirements
% }
% {
%     \item CAD models and mechanical drawings
%     \item Electrical schematics
%     \item Bill of materials (BOM)
% }
% {\formatdate{2}{2}{2026}}{\formatdate{13}{2}{2026}}
% {100}

% \WPadd{4}{Procurement and Preparation}
% {Ensure availability and readiness of all components required for the test bench.}
% {input}
% {
%     \item Selection of suppliers and components
%     \item Ordering and procurement of parts
%     \item Incoming inspection and preparation of components
% }
% {
%     \item Procured and inspected components
%     \item Updated bill of materials and cost overview
% }
% {\formatdate{2}{2}{2026}}{\formatdate{13}{2}{2026}}
% {100}

% \WPadd{5}{Manufacturing, Assembly, and Integration}
% {Build and integrate the hydrogen-based power system test bench.}
% {input}
% {
%     \item Manufacturing of mechanical parts where required
%     \item Assembly of mechanical and electrical subsystems
%     \item Integration of FCU, CGG, fuel cell, electronics and fluidics
% }
% {
%     \item Fully assembled and integrated test bench
%     \item Integration and assembly documentation
% }
% {\formatdate{2}{2}{2026}}{\formatdate{13}{2}{2026}}
% {100}

% \WPadd{6}{Test Planning}
% {Define procedures and criteria for verifying system performance and safety.}
% {input}
% {
%     \item Definition of test objectives and success criteria
%     \item Development of test procedures and protocols
%     \item Safety and risk assessment for test execution
% }
% {
%     \item Test plan
%     \item Safety and risk assessment documentation
% }
% {\formatdate{2}{2}{2026}}{\formatdate{13}{2}{2026}}
% {100}

% \WPadd{7}{Testing and Data Collection}
% {Evaluate the performance of the test bench under controlled conditions.}
% {input}
% {
%     \item Execution of planned ground tests
%     \item Measurement of power output, efficiency and stability
%     \item Data logging and test documentation
% }
% {
%     \item Raw test data
%     \item Test logs and measurement records
% }
% {\formatdate{2}{2}{2026}}{\formatdate{13}{2}{2026}}
% {100}

% \WPadd{8}{Data Analysis and Feasibility Assessment}
% {Assess the technical feasibility of the power system based on test results.}
% {input}
% {
%     \item Analysis of measured test data
%     \item Comparison of results with requirements and theoretical expectations
%     \item Identification of system limitations and technical risks
% }
% {
%     \item Performance analysis results
%     \item Feasibility assessment and conclusions
% }
% {\formatdate{2}{2}{2026}}{\formatdate{13}{2}{2026}}
% {100}

% \WPadd{9}{Documentation and Reporting}
% {Document the project process, results, and conclusions in a professional manner.}
% {input}
% {
%     \item Writing of the research and project report
%     \item Preparation of presentations and supporting materials
%     \item Final review and submission of all deliverables
% }
% {
%     \item Final project report
%     \item Presentation materials
% }
% {\formatdate{2}{2}{2026}}{\formatdate{13}{2}{2026}}
% {100}

% \WPadd{10}{Optional: Drone Prototype Exploration}
% {Explore the applicability of the developed power system to a drone platform, if time allows.}
% {
%         \item Conceptual design of drone integration
%         \item Preliminary trade-off and feasibility analysis
%         \item Documentation of findings and limitations
% }
% {
%         \item Conceptual drone integration study
%         \item Design sketches and feasibility notes
% }

